# ============================================
# COPIA ESTE ARCHIVO COMPLETO
# ============================================
# 
# 1. Ve a tu microservicio
# 2. Abre .github/workflows/build-and-deploy.yml (o como se llame)
# 3. BORRA todo el contenido
# 4. PEGA este c√≥digo completo
# 5. Guarda y haz commit
#
# ============================================

name: Smart CI/CD Pipeline

on:
  push:
    branches: [main, develop, feature/*]
  pull_request:
    branches: [main, develop]

jobs:
  smart-pipeline:
    uses: carlosorbegoso/workflow-templates/.github/workflows/smart-pipeline.yml@main
    secrets:
      # PRODUCCI√ìN (los mismos secrets que ya tienes)
      SSH_HOST: ${{ secrets.SSH_HOST }}
      SSH_USER: ${{ secrets.SSH_USER }}
      SSH_PRIVATE_KEY: ${{ secrets.SSH_PRIVATE_KEY }}
      DEPLOY_PATH: ${{ secrets.DEPLOY_PATH }}
      DB_USERNAME: ${{ secrets.DB_USERNAME }}
      DB_PASSWORD: ${{ secrets.DB_PASSWORD }}
      
      # REGISTRY (los mismos que ya tienes)
      GHCR_USERNAME: ${{ secrets.GHCR_USERNAME }}
      GHCR_PAT: ${{ secrets.GHCR_PAT }}
      
      # DESARROLLO (nuevos - opcionales)
      # Si no los configuras, usar√° los de producci√≥n
      DEV_SSH_HOST: ${{ secrets.DEV_SSH_HOST }}
      DEV_SSH_USER: ${{ secrets.DEV_SSH_USER }}
      DEV_SSH_PRIVATE_KEY: ${{ secrets.DEV_SSH_PRIVATE_KEY }}
      DEV_DEPLOY_PATH: ${{ secrets.DEV_DEPLOY_PATH }}
      DEV_DB_USERNAME: ${{ secrets.DEV_DB_USERNAME }}
      DEV_DB_PASSWORD: ${{ secrets.DEV_DB_PASSWORD }}
      
      # CALIDAD (nuevo - opcional)
      SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}

# ============================================
# COMPORTAMIENTO AUTOM√ÅTICO:
# ============================================
#
# üìã PULL REQUEST (cualquier rama):
#   ‚úÖ Tests b√°sicos √∫nicamente
#   ‚è±Ô∏è Tiempo: 3-5 minutos
#   üö´ Sin build, sin deploy
#
# üöÄ PUSH A MAIN (producci√≥n):
#   ‚úÖ Build + Push + Deploy
#   ‚è±Ô∏è Tiempo: 5-8 minutos  
#   üö´ Sin tests (m√°xima velocidad)
#
# üîß PUSH A DEVELOP/FEATURE (desarrollo):
#   ‚úÖ Tests + Quality + Security + Build + Deploy
#   ‚è±Ô∏è Tiempo: 15-20 minutos
#   üìä Pipeline completo con an√°lisis
#
# ============================================
# SECRETS NECESARIOS:
# ============================================
#
# M√çNIMOS (los que ya tienes):
# - SSH_HOST, SSH_USER, SSH_PRIVATE_KEY, DEPLOY_PATH
# - DB_USERNAME, DB_PASSWORD
# - GHCR_USERNAME, GHCR_PAT
#
# OPCIONALES (para entornos separados):
# - DEV_SSH_HOST, DEV_SSH_USER, DEV_SSH_PRIVATE_KEY, DEV_DEPLOY_PATH
# - DEV_DB_USERNAME, DEV_DB_PASSWORD
# - SONAR_TOKEN (para an√°lisis de calidad)
#
# ============================================